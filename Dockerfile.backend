FROM ghcr.io/astral-sh/uv:python3.11-bookworm-slim

WORKDIR /app

#  install Python deps
COPY pyproject.toml uv.lock ./
ENV UV_PROJECT_ENVIRONMENT="/usr/local/" \
    UV_LINK_MODE=copy

RUN uv sync --frozen --no-dev

#  (optional) download the MedEmbed model once at buildâ€‘time
RUN python - <<'PY'
from transformers import AutoTokenizer, AutoModel
AutoTokenizer.from_pretrained("abhinand/MedEmbed-large-v0.1")
AutoModel.from_pretrained("abhinand/MedEmbed-large-v0.1")
PY

#  copy source
COPY . .

EXPOSE 8080
ENV FLASK_ENV=production       
CMD ["uv", "run", "app.py"]

